<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>01 - Download • sen2tool</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="01 - Download">
<meta property="og:description" content="sen2tool">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sen2tool</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-download.html">01 - Download</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="01-download_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>01 - Download</h1>
                        <h4 class="author">Darius Görgen</h4>
            
            <h4 class="date">2020-08-18</h4>
      
      
      <div class="hidden name"><code>01-download.Rmd</code></div>

    </div>

    
    
<div id="preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#preparation" class="anchor"></a>Preparation</h2>
<p>The sen2tool package allows us to easily download and work with Sentinel-2 (S2) Level 1C datasets. These datasets represent top of the atmosphere (TOA) reflectance values, thus they are not suitable for every analysis. However, for most applications based on indices, they are able to deliver robust results in a timely fashion. This is the main advantage of the present package in comparison to other packages working with S2 data such as sen2r. sen2r works on level 2B datasets which means that either you have to order the corresponding tiles from the SentinelHub or process the level 1C data locally on your machine using sen2cor. Both methods consume a lot of time and resources. sen2tool downloads S2 data from a public Google Bucket which are available directly without the need of a user account or waiting time for placing orders. To download from the bucket one prerequisite is that the download tool gsutil is installed on your machine and available on the command line. Instructions to install the tool on various operating systems (OS) can be found <a href="https://cloud.google.com/storage/docs/gsutil_install">here</a>. Once you installed the software open a command line of your choice and enter the following line. You should get some version info on the gsutil tool otherwise something went wrong during the installation.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">gsutil</span> version</span></code></pre></div>
<p>Another option to use sen2tool in a reproducible environment is to use the Docker engine to create a containers based on our <a href="../../Dockerfile">Dockerfile</a>. Here, gsutil is automatically installed when the image is created.</p>
</div>
<div id="querying-data" class="section level2">
<h2 class="hasAnchor">
<a href="#querying-data" class="anchor"></a>Querying data</h2>
<p>To query data, the first step is to load the necessary libraries.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sf</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stars</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sen2tool</span>)</pre></body></html></div>
<p>For querying data there are two mandatory inputs. One is an area of interest represented by a <code>sf</code> object the other is the time window for which we are querying the data. An optional input is the maximum of cloud cover allowed for a scene to appear in our query. If it is not specified, then all scenes matching the mandatory inputs are downloaded.</p>
<p>We will now load an example object which is found within the <code>sen2tool</code> package.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">aoi</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_read.html">st_read</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"testregion.gpkg"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"sen2tool"</span>))</pre></body></html></div>
<p>There are two options you can decide how <code>sen2tool</code> internally is querying matching scenes. The one uses less local storage (~1.6 GB) but is usually slower, while the other occupies more local storage (~5 GB) but queries are faster retrieved. When the package is freshly installed and the <code><a href="../reference/downloadS2.html">downloadS2()</a></code> function is used for the first time, you should determine your decision with the <code>use_db</code> option. This options default is <code>TRUE</code> meaning that during the first execution the tile index file is downloaded from Google Bucket and translated to a local SQLite data base. Initially, this process takes some time, however as stated above future queries are then processed more quickly. In case you opt for not using a local database (<code>use_db = FALSE</code>) the tile index is also downloaded and translated to a <code>.csv</code> file. Queries are then applied to the <code>.csv</code> file which is why they are usually slower compared to the database approach. Note that either option you chose, the corresponding file is stored in the local installation path of the <code>sen2tool</code> packages. This is why when the package is re-installed, the tile index needs to be downloaded and processed again. You can find the local installation path of the package with /tmp/RtmpzKJLuK/temp_libpath11d4398c323/sen2tool.</p>
<p>Now, let us send a first query.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">tiles_seasonal</span> <span class="kw">=</span> <span class="fu"><a href="../reference/downloadS2.html">downloadS2</a></span>(<span class="kw">aoi</span> <span class="kw">=</span> <span class="no">aoi</span>,
                            <span class="kw">time_window</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2016-06-01"</span>, <span class="st">"2019-09-30"</span>),
                            <span class="kw">time_period</span> <span class="kw">=</span> <span class="st">"seasonal"</span>,
                            <span class="kw">rootdir</span> <span class="kw">=</span> <span class="st">"."</span>,
                            <span class="kw">extent_name</span> <span class="kw">=</span> <span class="st">"test"</span>,
                            <span class="kw">max_cloud</span> <span class="kw">=</span> <span class="fl">75</span>,
                            <span class="kw">use_db</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                            <span class="kw">force_update</span> <span class="kw">=</span> <span class="no">F</span>,
                            <span class="kw">query_only</span> <span class="kw">=</span> <span class="no">T</span> )</pre></body></html></div>
<p>This query needs some explanation. First, we specified our area of interest (AOI) which fixes the spatial extent for matching scenes. Second, we queried data between the June, 1st 2016 and September, 30th 2019. However, with the option <code>time_period = "seasonal"</code> we tell the function not to deliver every matching scene between these two dates, but to deliver seasonal matches meaning that every scene with a date between June, 1st and September 30th is returned for the years 2016 to 2019. The <code>rootdir</code> options specifies the directory to which files are downloaded. They are then placed inside a child directory of <code>rootdir</code> named according to the option <code>extent_name</code>. We also specified that the maximum cloud cover for matching scenes should not be higher than 75 %. With <code>use_db = TRUE</code> we told the function to check for an SQLite database in the package directory and query the data from there. We could have specified <code>force_update = TRUE</code> which would cause the function to download the most recent tile index from the Google Bucket again and update the database. Last, we told the function to not really download the data, but only apply the query. This will return a data.frame with some information of the matching scenes.</p>
<p>Here we found 113 matching results for our query. Let’s see how many scenes will match our AOI when we change some of the parameters.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">tiles_all</span> <span class="kw">=</span> <span class="fu"><a href="../reference/downloadS2.html">downloadS2</a></span>(<span class="kw">aoi</span> <span class="kw">=</span> <span class="no">aoi</span>,
                       <span class="kw">time_window</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2016-06-01"</span>, <span class="st">"2019-09-30"</span>),
                       <span class="kw">time_period</span> <span class="kw">=</span> <span class="st">"full"</span>,
                       <span class="kw">rootdir</span> <span class="kw">=</span> <span class="st">"."</span>,
                       <span class="kw">extent_name</span> <span class="kw">=</span> <span class="st">"test"</span>,
                       <span class="kw">max_cloud</span> <span class="kw">=</span> <span class="fl">20</span>,
                       <span class="kw">use_db</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                       <span class="kw">force_update</span> <span class="kw">=</span> <span class="no">F</span>,
                       <span class="kw">query_only</span> <span class="kw">=</span> <span class="no">T</span>)</pre></body></html></div>
<p>We changed the maximum allowed cloud cover and changed the <code>time_period</code> option to “full”. In this case the query delivered 226 results. When we leave out the <code>query_only</code> option or explicitly set it to <code>FALSE</code>, the matching data will be downloaded into <code>&lt;rootdir&gt;/&lt;extent_name&gt;/L1C</code>. The function will print some informative messages during the process, however, since the download is time consuming this is not presented in this documentation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://maptailor.net/">MapTailor GbR</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
